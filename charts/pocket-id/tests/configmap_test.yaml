# yaml-language-server: $schema=https://raw.githubusercontent.com/helm-unittest/helm-unittest/main/schema/helm-testsuite.json
suite: Pocket-ID ConfigMap tests

templates:
  - configmap.yaml

tests:
  - it: Should fail for unknown provider
    set:
      database.provider: mysql
    asserts:
      - failedTemplate:
          errorMessage: >-
            Invalid database provider: mysql. .Values.database.provider must be
            'sqlite' or 'postgres'.

  - it: Should not create ConfigMap
    set:
      config.create: false
    asserts:
      - hasDocuments:
          count: 0

  - it: Should create ConfigMap with defaults
    asserts:
      - isKind:
          of: ConfigMap
      - isSubset:
          path: data
          content:
            DB_PROVIDER: sqlite
            GEOLITE_DB_URL: "https://download.maxmind.com/app/geoip_download?edition_id=GeoLite2-City&license_key=%s&suffix=tar.gz"
            PUBLIC_APP_URL: "https://pocket-id.example.local"
            TZ: "Etc/UTC"
