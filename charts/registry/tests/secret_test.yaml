# yaml-language-server: $schema=https://raw.githubusercontent.com/helm-unittest/helm-unittest/main/schema/helm-testsuite.json
suite: Secret

templates:
  - secret.yaml

tests:
  - it: Should fail for unset storage accessKey value configuration
    set: {}
    asserts:
      - failedTemplate:
          errorMessage: >-
            .Values.secrets.storage.accessKey.value is required

  - it: Should fail for unset storage secretKey value configuration
    set:
      secrets.storage:
        accessKey:
          value: test
    asserts:
      - failedTemplate:
          errorMessage: >-
            .Values.secrets.storage.secretKey.value is required

  - it: Should fail for unset storage region value configuration
    set:
      secrets.storage:
        accessKey:
          value: test
        secretKey:
          value: test
    asserts:
      - failedTemplate:
          errorMessage: >-
            .Values.secrets.storage.region.value is required

  - it: Should fail for unset storage endpoint value configuration
    set:
      secrets.storage:
        accessKey:
          value: test
        secretKey:
          value: test
        region:
          value: test
    asserts:
      - failedTemplate:
          errorMessage: >-
            .Values.secrets.storage.endpoint.value is required

  - it: Should fail for unset storage bucket value configuration
    set:
      secrets.storage:
        accessKey:
          value: test
        secretKey:
          value: test
        region:
          value: test
        endpoint:
          value: test
    asserts:
      - failedTemplate:
          errorMessage: >-
            .Values.secrets.storage.bucket.value is required

  - it: Should not create Secret
    set:
      secrets.storage.create: false
      secrets.http.create: false
    asserts:
      - hasDocuments:
          count: 0

  - it: Should create Secret with provided values
    set:
      secrets.storage:
        accessKey:
          value: test
        secretKey:
          value: test
        region:
          value: test
        endpoint:
          value: test
        bucket:
          value: test
    asserts:
      - documentIndex: 0
        isKind:
          of: Secret
      - documentIndex: 1
        isKind:
          of: Secret
